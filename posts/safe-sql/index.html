<!DOCTYPE html><html lang="en-US" ><head> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-102676367-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-102676367-1'); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Safe Dynamic Sql Generator" /><meta name="author" content="Jason" /><meta property="og:locale" content="en_US" /><meta name="description" content="TL; DR There is always a desire to dynamically limit the results of large tables. The need to limit, and order columns dynamically. And then, filter on these modified columns. You either have to do some machinations to allow the shape of the data to appear to change for the user, or you result to dynamic SQL. The problem with dynamic SQL is that it opens your server up to attack. So, what if you could do dynamic SQL without the risk to attack? That was the goal to making Safe Sql Builder. What is Safe Dynamic Sql Generator Safe Dynamic SQL Generator is a tool that takes a predetermined list of valid column names and uses that to generate valid parameterized sql based off of a supplied query specification. In other words, it takes an untrusted request that defines the desired query, and generates SQL from a preconfigured setup. This query is parameterized, and built using the predetermined configuration not the request. Why My team had a need to develop a highly customizable website that showed data from a very wide and deep table. The customer needed to be able to slice the data into smaller chunks dynamically. Not wanting to simply concatenate strings together, we engineered a way to break the configuration into 2 parts. One is provided by the developer, the other by the client. We trust the configuration given by the developer, but not that given by the client. This allowed us to simplify our domain and make an application that could be used in endless ways. How to Use The Orchestrator is setup with the following fields: var validColumns = new ValidColumns(new [] { &quot;ProductId&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;MakeFlag&quot;, &quot;FinishedGoodsFlag&quot;, &quot;Color&quot;, &quot;SafetyStockLevel&quot;, &quot;ReorderPoint&quot;, &quot;StandardCost&quot;, &quot;ProductLine&quot;, }); Then it receives a query object that looks like this: var query = new Query { Fields = new[] { &quot;ProductId&quot;, &quot;Color&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;ProductLine&quot;, &quot;StandardCost&quot;, }, Distinct = true, Filters = new[] { new Filter {Property = &quot;ProductLine&quot;, Values = new object[] {&quot;Canceled&quot;}}, new Filter {Property = &quot;Name&quot;, Values = new object[] {&quot;Joe&#39;s Car&quot;}}, }, Sort = &quot;ProductNumber&quot;, Direction = &quot;asc&quot; }; var builder = new QueryOrchestrator(); var (sql, _) = builder.BuildQuery(query, validColumns, &quot;[AdventureWorks].[Product]&quot;); It will produce a SQL statement that looks like: SELECT [ProductId] ,[Color] ,[Name] ,[ProductNumber] ,[ProductLine] ,[StandardCost] FROM [AdventureWorks].[Product] WHERE ([ProductLine] = @ProductLine_EQUAL) AND ([Name] = @Name_EQUAL) ORDER BY CASE WHEN [ProductNumber] IS NULL THEN 1 ELSE 0 END ,[ProductNumber] Contributors ✨ Thanks goes to these wonderful people (emoji key): EDF Renewables💵 Chris Stead🤔 patrickhigh💻 🤔 Mike Lazar💻" /><meta property="og:description" content="TL; DR There is always a desire to dynamically limit the results of large tables. The need to limit, and order columns dynamically. And then, filter on these modified columns. You either have to do some machinations to allow the shape of the data to appear to change for the user, or you result to dynamic SQL. The problem with dynamic SQL is that it opens your server up to attack. So, what if you could do dynamic SQL without the risk to attack? That was the goal to making Safe Sql Builder. What is Safe Dynamic Sql Generator Safe Dynamic SQL Generator is a tool that takes a predetermined list of valid column names and uses that to generate valid parameterized sql based off of a supplied query specification. In other words, it takes an untrusted request that defines the desired query, and generates SQL from a preconfigured setup. This query is parameterized, and built using the predetermined configuration not the request. Why My team had a need to develop a highly customizable website that showed data from a very wide and deep table. The customer needed to be able to slice the data into smaller chunks dynamically. Not wanting to simply concatenate strings together, we engineered a way to break the configuration into 2 parts. One is provided by the developer, the other by the client. We trust the configuration given by the developer, but not that given by the client. This allowed us to simplify our domain and make an application that could be used in endless ways. How to Use The Orchestrator is setup with the following fields: var validColumns = new ValidColumns(new [] { &quot;ProductId&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;MakeFlag&quot;, &quot;FinishedGoodsFlag&quot;, &quot;Color&quot;, &quot;SafetyStockLevel&quot;, &quot;ReorderPoint&quot;, &quot;StandardCost&quot;, &quot;ProductLine&quot;, }); Then it receives a query object that looks like this: var query = new Query { Fields = new[] { &quot;ProductId&quot;, &quot;Color&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;ProductLine&quot;, &quot;StandardCost&quot;, }, Distinct = true, Filters = new[] { new Filter {Property = &quot;ProductLine&quot;, Values = new object[] {&quot;Canceled&quot;}}, new Filter {Property = &quot;Name&quot;, Values = new object[] {&quot;Joe&#39;s Car&quot;}}, }, Sort = &quot;ProductNumber&quot;, Direction = &quot;asc&quot; }; var builder = new QueryOrchestrator(); var (sql, _) = builder.BuildQuery(query, validColumns, &quot;[AdventureWorks].[Product]&quot;); It will produce a SQL statement that looks like: SELECT [ProductId] ,[Color] ,[Name] ,[ProductNumber] ,[ProductLine] ,[StandardCost] FROM [AdventureWorks].[Product] WHERE ([ProductLine] = @ProductLine_EQUAL) AND ([Name] = @Name_EQUAL) ORDER BY CASE WHEN [ProductNumber] IS NULL THEN 1 ELSE 0 END ,[ProductNumber] Contributors ✨ Thanks goes to these wonderful people (emoji key): EDF Renewables💵 Chris Stead🤔 patrickhigh💻 🤔 Mike Lazar💻" /><link rel="canonical" href="https://jason.teamkerney.com/posts/safe-sql/" /><meta property="og:url" content="https://jason.teamkerney.com/posts/safe-sql/" /><meta property="og:site_name" content="Jason’s Thoughts" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-16T06:00:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Safe Dynamic Sql Generator" /><meta name="twitter:site" content="@JasonKerney" /><meta name="twitter:creator" content="@Jason" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jason"},"dateModified":"2021-04-16T06:00:00-07:00","datePublished":"2021-04-16T06:00:00-07:00","description":"TL; DR There is always a desire to dynamically limit the results of large tables. The need to limit, and order columns dynamically. And then, filter on these modified columns. You either have to do some machinations to allow the shape of the data to appear to change for the user, or you result to dynamic SQL. The problem with dynamic SQL is that it opens your server up to attack. So, what if you could do dynamic SQL without the risk to attack? That was the goal to making Safe Sql Builder. What is Safe Dynamic Sql Generator Safe Dynamic SQL Generator is a tool that takes a predetermined list of valid column names and uses that to generate valid parameterized sql based off of a supplied query specification. In other words, it takes an untrusted request that defines the desired query, and generates SQL from a preconfigured setup. This query is parameterized, and built using the predetermined configuration not the request. Why My team had a need to develop a highly customizable website that showed data from a very wide and deep table. The customer needed to be able to slice the data into smaller chunks dynamically. Not wanting to simply concatenate strings together, we engineered a way to break the configuration into 2 parts. One is provided by the developer, the other by the client. We trust the configuration given by the developer, but not that given by the client. This allowed us to simplify our domain and make an application that could be used in endless ways. How to Use The Orchestrator is setup with the following fields: var validColumns = new ValidColumns(new [] { &quot;ProductId&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;MakeFlag&quot;, &quot;FinishedGoodsFlag&quot;, &quot;Color&quot;, &quot;SafetyStockLevel&quot;, &quot;ReorderPoint&quot;, &quot;StandardCost&quot;, &quot;ProductLine&quot;, }); Then it receives a query object that looks like this: var query = new Query { Fields = new[] { &quot;ProductId&quot;, &quot;Color&quot;, &quot;Name&quot;, &quot;ProductNumber&quot;, &quot;ProductLine&quot;, &quot;StandardCost&quot;, }, Distinct = true, Filters = new[] { new Filter {Property = &quot;ProductLine&quot;, Values = new object[] {&quot;Canceled&quot;}}, new Filter {Property = &quot;Name&quot;, Values = new object[] {&quot;Joe&#39;s Car&quot;}}, }, Sort = &quot;ProductNumber&quot;, Direction = &quot;asc&quot; }; var builder = new QueryOrchestrator(); var (sql, _) = builder.BuildQuery(query, validColumns, &quot;[AdventureWorks].[Product]&quot;); It will produce a SQL statement that looks like: SELECT [ProductId] ,[Color] ,[Name] ,[ProductNumber] ,[ProductLine] ,[StandardCost] FROM [AdventureWorks].[Product] WHERE ([ProductLine] = @ProductLine_EQUAL) AND ([Name] = @Name_EQUAL) ORDER BY CASE WHEN [ProductNumber] IS NULL THEN 1 ELSE 0 END ,[ProductNumber] Contributors ✨ Thanks goes to these wonderful people (emoji key): EDF Renewables💵 Chris Stead🤔 patrickhigh💻 🤔 Mike Lazar💻","headline":"Safe Dynamic Sql Generator","mainEntityOfPage":{"@type":"WebPage","@id":"https://jason.teamkerney.com/posts/safe-sql/"},"url":"https://jason.teamkerney.com/posts/safe-sql/"}</script><title>Safe Dynamic Sql Generator | Jason's Thoughts</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-102676367-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-102676367-1'); }); </script> <script id="mcjs">!function (c, h, i, m, p) { m = c.createElement(h), p = c.getElementsByTagName(h)[0], m.async = 1, m.src = i, p.parentNode.insertBefore(m, p) }(document, "script", "https://chimpstatic.com/mcjs-connected/js/users/c00d6edd05c05abd6195955f8/1dd9dc3d8457cdcc4388e5885.js");</script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/me/MyLogo-Big.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Jason's Thoughts</a></div><div class="site-subtitle font-italic">An individual that cares about the people side of programming.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>HISTORY</span> </a><li class="nav-item"> <a href="/now/" class="nav-link"> <i class="fa-fw fas fa-clock ml-xl-3 mr-xl-3 unloaded"></i> <span>NOW</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/series/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>SERIES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/jason-kerney" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://geekdom.social/@jasonkerney" aria-label="mastodon" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-mastodon"></i> </a> <a href="https://twitter.com/JasonKerney" aria-label="twitter" class="order-5" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href="https://www.linkedin.com/in/jasonkerney/" aria-label="linkedin" class="order-6" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="https://www.npmjs.com/~jasonkerney" aria-label="npm" class="order-7" target="_blank" rel="noopener"> <i class="fab fa-npm"></i> </a> <a href="https://www.nuget.org/profiles/JasonKerney" aria-label="nuget" class="order-8" target="_blank" rel="noopener"> <i class="fab fa-windows"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['blog','teamkerney.com'].join('@')" aria-label="email" class="order-9" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-10" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Safe Dynamic Sql Generator</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Safe Dynamic Sql Generator</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Jason </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 16, 2021, 6:00 AM -0700" prep="on" > Apr 16, 2021 <i class="unloaded">2021-04-16T06:00:00-07:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="422 words">2 min</span></div></div><div class="post-content"><h2 id="tl-dr">TL; DR</h2><p>There is always a desire to dynamically limit the results of large tables. The need to limit, and order columns dynamically. And then, filter on these modified columns. You either have to do some machinations to allow the shape of the data to appear to change for the user, or you result to <strong><em><span style="color: red;">dynamic</span></em></strong> SQL.</p><p>The problem with dynamic SQL is that it opens your server up to attack. So, <em>what if</em> you could do dynamic SQL without the risk to attack? That was the goal to making Safe Sql Builder.</p><hr /><p><a href="https://github.com/jason-kerney/SafeSqlBuilder"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://github.com/jason-kerney/SafeSqlBuilder/workflows/.NET%20Core/badge.svg" alt=".NET Core" /></a> <a href="https://github.com/jason-kerney/SafeSqlBuilder/blob/main/LICENSE"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.shields.io/github/license/jason-kerney/SafeSqlBuilder" alt="License" /></a> <a href="https://www.nuget.org/packages/safe-dynamic-sql-generator/"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://img.shields.io/nuget/v/safe-dynamic-sql-generator.svg" alt="Nuget" /></a></p><h2 id="what-is-safe-dynamic-sql-generator">What is Safe Dynamic Sql Generator</h2><p>Safe Dynamic SQL Generator is a tool that takes a predetermined list of valid column names and uses that to generate valid parameterized sql based off of a supplied query specification.</p><p>In other words, it takes an untrusted request that defines the desired query, and generates SQL from a preconfigured setup. This query is parameterized, and built using the predetermined configuration not the request.</p><h2 id="why">Why</h2><p>My team had a need to develop a highly customizable website that showed data from a very wide and deep table. The customer needed to be able to slice the data into smaller chunks dynamically. Not wanting to simply concatenate strings together, we engineered a way to break the configuration into 2 parts. One is provided by the developer, the other by the client. We trust the configuration given by the developer, but not that given by the client.</p><p>This allowed us to simplify our domain and make an application that could be used in endless ways.</p><h2 id="how-to-use">How to Use</h2><p>The Orchestrator is setup with the following fields:</p><pre><code class="language-C#">var validColumns = new ValidColumns(new []
{
    "ProductId",
    "Name",
    "ProductNumber",
    "MakeFlag",
    "FinishedGoodsFlag",
    "Color",
    "SafetyStockLevel",
    "ReorderPoint",
    "StandardCost",
    "ProductLine",
});
</code></pre><p>Then it receives a query object that looks like this:</p><pre><code class="language-C#">var query = new Query
{
    Fields = new[]
    {
        "ProductId",
        "Color",
        "Name",
        "ProductNumber",
        "ProductLine",
        "StandardCost",
    },
    Distinct = true,
    Filters = new[]
    {
        new Filter {Property = "ProductLine", Values = new object[] {"Canceled"}},
        new Filter {Property = "Name", Values = new object[] {"Joe's Car"}},
    },
    Sort = "ProductNumber",
    Direction = "asc"
};

var builder = new QueryOrchestrator();
var (sql, _) = builder.BuildQuery(query, validColumns, "[AdventureWorks].[Product]");
</code></pre><p>It will produce a SQL statement that looks like:</p><pre><code class="language-SQL">SELECT [ProductId]
               ,[Color]
               ,[Name]
               ,[ProductNumber]
               ,[ProductLine]
               ,[StandardCost]
FROM [AdventureWorks].[Product]
WHERE ([ProductLine] = @ProductLine_EQUAL)
               AND ([Name] = @Name_EQUAL)
ORDER BY CASE
                WHEN [ProductNumber] IS NULL
                                THEN 1
                ELSE 0
                END
               ,[ProductNumber]
</code></pre><h2 id="contributors-">Contributors ✨</h2><p>Thanks goes to these wonderful people (<a href="https://allcontributors.org/docs/en/emoji-key">emoji key</a>):</p><div class="table-wrapper"><table><tr><td align="center"><a href="https://github.com/edf-re"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://avatars.githubusercontent.com/u/13739273?v=4?s=100" width="100px;" alt="" /><br /><sub><b>EDF Renewables</b></sub></a><br /><a href="#financial-edf-re" title="Financial">💵</a><td align="center"><a href="http://www.chrisstead.net/"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://avatars.githubusercontent.com/u/4184510?v=4?s=100" width="100px;" alt="" /><br /><sub><b>Chris Stead</b></sub></a><br /><a href="#ideas-cmstead" title="Ideas, Planning, &amp; Feedback">🤔</a><td align="center"><a href="https://github.com/patrickhigh"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://avatars.githubusercontent.com/u/45110206?v=4?s=100" width="100px;" alt="" /><br /><sub><b>patrickhigh</b></sub></a><br /><a href="https://github.com/jason-kerney/SafeSqlBuilder/commits?author=patrickhigh" title="Code">💻</a> <a href="#ideas-patrickhigh" title="Ideas, Planning, &amp; Feedback">🤔</a><td align="center"><a href="https://github.com/seventumbles"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://avatars.githubusercontent.com/u/1326703?v=4?s=100" width="100px;" alt="" /><br /><sub><b>Mike Lazar</b></sub></a><br /><a href="https://github.com/jason-kerney/SafeSqlBuilder/commits?author=seventumbles" title="Code">💻</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/development/'>development</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tool/" class="post-tag no-text-decoration" >tool</a> <a href="/tags/open-source/" class="post-tag no-text-decoration" >open source</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Safe Dynamic Sql Generator - Jason's Thoughts&url=https://jason.teamkerney.com/posts/safe-sql/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Safe Dynamic Sql Generator - Jason's Thoughts&u=https://jason.teamkerney.com/posts/safe-sql/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Safe Dynamic Sql Generator - Jason's Thoughts&url=https://jason.teamkerney.com/posts/safe-sql/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/human-systems/">human systems</a> <a class="post-tag" href="/tags/people/">people</a> <a class="post-tag" href="/tags/process/">process</a> <a class="post-tag" href="/tags/well-being/">well-being</a> <a class="post-tag" href="/tags/mindset/">mindset</a> <a class="post-tag" href="/tags/open-source/">open source</a> <a class="post-tag" href="/tags/agility/">agility</a> <a class="post-tag" href="/tags/community/">community</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a> <a class="post-tag" href="/tags/retrospective/">retrospective</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/project-sync/"><div class="card-body"> <span class="timeago small" > Jun 11, 2021 <i class="unloaded">2021-06-11T06:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Project Sync</h3><div class="text-muted small"><p> TL; DR I needed a tool to allow me to manage local Azure Git directories from the Terminal. So, I built it and am sharing it. What is Project Sync This is a tool born out of need. My team w...</p></div></div></a></div><div class="card"> <a href="/posts/my-workshop/"><div class="card-body"> <span class="timeago small" > May 7, 2021 <i class="unloaded">2021-05-07T06:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Workshop I helped Create</h3><div class="text-muted small"><p> TL; DR Zach Bonaker and I made a simulation exercise I am really proud of. It focuses on how the environmental rules determine a team’s success. Here is where you can try it. Photo by Pixabay ...</p></div></div></a></div><div class="card"> <a href="/posts/a-all-contributors/"><div class="card-body"> <span class="timeago small" > Apr 23, 2021 <i class="unloaded">2021-04-23T06:00:00-07:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The Magic of 'All Contributors ✨'</h3><div class="text-muted small"><p> TL; DR Giving people recognition is good. The “All Contributors ✨” specification and tool set makes this easy. So please use it and tell people about it. This post is part of the series {{ p...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/pet-peeve/" class="btn btn-outline-primary" prompt="Older"><p>Pet Peeve</p></a> <a href="/posts/a-all-contributors/" class="btn btn-outline-primary" prompt="Newer"><p>The Magic of 'All Contributors ✨'</p></a></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://twitter.com/JasonKerney">R. Jason Kerney</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/human-systems/">human systems</a> <a class="post-tag" href="/tags/people/">people</a> <a class="post-tag" href="/tags/process/">process</a> <a class="post-tag" href="/tags/well-being/">well being</a> <a class="post-tag" href="/tags/mindset/">mindset</a> <a class="post-tag" href="/tags/open-source/">open source</a> <a class="post-tag" href="/tags/agility/">agility</a> <a class="post-tag" href="/tags/community/">community</a> <a class="post-tag" href="/tags/philosophy/">philosophy</a> <a class="post-tag" href="/tags/retrospective/">retrospective</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://jason.teamkerney.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
